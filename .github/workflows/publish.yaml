name: Build, Test and Publish

on:
    pull_request:
        types: [opened, synchronize]
    push:
        branches:
            - main


jobs:
    build-test-and-publish:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3
            - name: Setup Python
              uses: actions/setup-python@v3
              with:
                python-version: 3.11
            - run: |
                /bin/bash run.sh install
                /bin/bash run.sh build
                /bin/bash run.sh publish:test
              env:
                TEST_PYPI_TOKEN: ${{ secrets.TEST_PYPI_TOKEN }}
                PROD_PYPI_TOKEN: ${{ secrets.PROD_PYPI_TOKEN }}

            # - name: Install dependencies
            #   run: |
            #     pip install --upgrade pip
            #     pip install pre-commit
            # - name: Lint
            #   run: |
            #     SKIP=no-commit-to-branch precommit run --all-files
